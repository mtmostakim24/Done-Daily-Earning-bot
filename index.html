<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Daily Earning545 | Real Admin Panel</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', system-ui, sans-serif;
    }
    
    :root {
      --primary: #4361ee;
      --primary-dark: #3a56d4;
      --secondary: #4cc9f0;
      --success: #4ade80;
      --warning: #f59e0b;
      --danger: #ef4444;
      --dark: #1e293b;
      --light: #f8fafc;
      --card-bg: #ffffff;
      --body-bg: #f1f5f9;
      --shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
      --transition: all 0.3s ease;
    }
    
    body {
      background-color: var(--body-bg);
      color: var(--dark);
      min-height: 100vh;
      background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
    }
    
    /* Header Styles */
    header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: var(--shadow);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    header .title {
      display: flex;
      align-items: center;
      gap: 10px;
      color: white;
      font-size: 1.2rem;
      font-weight: 700;
    }
    
    header .title i {
      font-size: 1.5rem;
    }
    
    /* Admin Panel Styles */
    .admin-container {
      padding: 20px;
      max-width: 1400px;
      margin: 0 auto;
    }
    
    .admin-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      flex-wrap: wrap;
      gap: 15px;
    }
    
    .admin-title {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--dark);
    }
    
    .admin-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
    }
    
    .stat-card {
      background: white;
      border-radius: 15px;
      padding: 20px;
      box-shadow: var(--shadow);
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    
    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      height: 5px;
      width: 100%;
      background: linear-gradient(to right, var(--primary), var(--secondary));
    }
    
    .stat-value {
      font-size: 2rem;
      font-weight: 800;
      color: var(--primary);
      margin-bottom: 5px;
    }
    
    .stat-label {
      font-size: 0.9rem;
      color: #666;
    }
    
    .card {
      background: var(--card-bg);
      margin-bottom: 20px;
      padding: 20px;
      border-radius: 20px;
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
    }
    
    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      height: 5px;
      width: 100%;
      background: linear-gradient(to right, var(--primary), var(--secondary));
    }
    
    .card-header {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
      gap: 10px;
    }
    
    .card-header i {
      width: 40px;
      height: 40px;
      background: rgba(67, 97, 238, 0.1);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--primary);
      font-size: 1.2rem;
    }
    
    .card-header h3 {
      font-size: 1.1rem;
      color: var(--dark);
    }
    
    .card-content {
      padding: 5px 0;
    }
    
    /* Table Styles */
    .table-container {
      overflow-x: auto;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
    }
    
    th, td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid #e2e8f0;
    }
    
    th {
      background-color: #f8fafc;
      font-weight: 600;
      color: var(--dark);
    }
    
    tr:hover {
      background-color: #f8fafc;
    }
    
    .status-pending {
      color: var(--warning);
      font-weight: 600;
    }
    
    .status-completed {
      color: var(--success);
      font-weight: 600;
    }
    
    .status-rejected {
      color: var(--danger);
      font-weight: 600;
    }
    
    /* Button Styles */
    .button {
      display: inline-block;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: white;
      padding: 10px 20px;
      text-align: center;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      box-shadow: 0 4px 10px rgba(67, 97, 238, 0.3);
      border: none;
      font-size: 0.9rem;
      margin-right: 5px;
      margin-bottom: 5px;
    }
    
    .button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(67, 97, 238, 0.4);
    }
    
    .button-success {
      background: linear-gradient(135deg, var(--success) 0%, #22c55e 100%);
      box-shadow: 0 4px 10px rgba(74, 222, 128, 0.3);
    }
    
    .button-danger {
      background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
      box-shadow: 0 4px 10px rgba(239, 68, 68, 0.3);
    }
    
    .button-warning {
      background: linear-gradient(135deg, var(--warning) 0%, #d97706 100%);
      box-shadow: 0 4px 10px rgba(245, 158, 11, 0.3);
    }
    
    .button-small {
      padding: 6px 12px;
      font-size: 0.8rem;
    }
    
    /* Input Styles */
    .input-group {
      margin-bottom: 15px;
    }
    
    .input-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--dark);
    }
    
    input, select, textarea {
      width: 100%;
      padding: 14px;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      font-size: 1rem;
      background: #f8fafc;
      transition: var(--transition);
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
    }
    
    /* Search Bar */
    .search-bar {
      display: flex;
      margin-bottom: 20px;
      gap: 10px;
    }
    
    .search-bar input {
      flex: 1;
    }
    
    /* Notification */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: white;
      padding: 15px 25px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      transform: translateX(120%);
      transition: transform 0.3s ease;
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .notification.show {
      transform: translateX(0);
    }
    
    .notification.success {
      border-left: 4px solid var(--success);
    }
    
    .notification.error {
      border-left: 4px solid var(--danger);
    }
    
    .notification.warning {
      border-left: 4px solid var(--warning);
    }
    
    /* Login Form */
    .login-container {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }
    
    .login-card {
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: var(--shadow);
      width: 100%;
      max-width: 400px;
      text-align: center;
    }
    
    .login-logo {
      font-size: 2.5rem;
      color: var(--primary);
      margin-bottom: 20px;
    }
    
    .login-title {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 30px;
      color: var(--dark);
    }
    
    /* Tabs */
    .tabs {
      display: flex;
      border-bottom: 1px solid #e2e8f0;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .tab {
      padding: 12px 20px;
      cursor: pointer;
      font-weight: 500;
      color: #666;
      border-bottom: 3px solid transparent;
      transition: var(--transition);
    }
    
    .tab.active {
      color: var(--primary);
      border-bottom: 3px solid var(--primary);
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    /* User Management */
    .user-card {
      background: white;
      border-radius: 15px;
      padding: 15px;
      box-shadow: var(--shadow);
      margin-bottom: 15px;
    }
    
    .user-header {
      display: flex;
      justify-content: between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .user-name {
      font-weight: 600;
      color: var(--dark);
    }
    
    .user-id {
      font-size: 0.8rem;
      color: #666;
    }
    
    .user-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-bottom: 10px;
    }
    
    .user-stat {
      text-align: center;
      background: #f8fafc;
      border-radius: 10px;
      padding: 10px;
    }
    
    .user-stat-value {
      font-weight: 700;
      color: var(--primary);
    }
    
    .user-stat-label {
      font-size: 0.7rem;
      color: #666;
    }
    
    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 2000;
      justify-content: center;
      align-items: center;
    }
    
    .modal-content {
      background: white;
      border-radius: 20px;
      padding: 30px;
      width: 90%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
    }
    
    .modal-header {
      display: flex;
      justify-content: between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .modal-title {
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--dark);
    }
    
    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #666;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .admin-stats {
        grid-template-columns: 1fr;
      }
      
      th, td {
        padding: 8px 10px;
        font-size: 0.9rem;
      }
      
      .button {
        padding: 8px 15px;
        font-size: 0.8rem;
      }
      
      .tabs {
        flex-direction: column;
      }
      
      .tab {
        text-align: center;
      }
    }
  </style>
</head>
<body>
  <div class="notification" id="notification">
    <i class="fas fa-check-circle"></i>
    <span id="notification-message">Notification message</span>
  </div>
  
  <!-- Login Page -->
  <div id="login-page" class="login-container">
    <div class="login-card">
      <div class="login-logo">
        <i class="fas fa-user-shield"></i>
      </div>
      <div class="login-title">Daily Earning545 Admin</div>
      
      <div class="input-group">
        <label>Admin Username</label>
        <input type="text" id="admin-username" placeholder="Enter admin username">
      </div>
      
      <div class="input-group">
        <label>Password</label>
        <input type="password" id="admin-password" placeholder="Enter admin password">
      </div>
      
      <button class="button" style="width: 100%; margin-top: 10px;" onclick="adminLogin()">
        <i class="fas fa-sign-in-alt"></i> Login to Admin Panel
      </button>
      
      <div style="margin-top: 20px; padding: 15px; background: #f8fafc; border-radius: 10px; font-size: 0.9rem;">
        <strong>Default Login:</strong><br>
        Username: <code>admin</code><br>
        Password: <code>admin123</code>
      </div>
    </div>
  </div>
  
  <!-- Admin Panel -->
  <div id="admin-panel" style="display: none;">
    <header>
      <div class="title">
        <i class="fas fa-user-shield"></i>
        <span>Daily Earning545 - Real Admin Panel</span>
      </div>
      <div style="color: white; display: flex; align-items: center; gap: 15px;">
        <i class="fas fa-user-circle"></i>
        <span id="admin-name">Super Admin</span>
        <button class="button button-danger button-small" onclick="adminLogout()">
          <i class="fas fa-sign-out-alt"></i> Logout
        </button>
      </div>
    </header>
    
    <div class="admin-container">
      <div class="admin-header">
        <div class="admin-title">Admin Dashboard</div>
        <div class="search-bar">
          <input type="text" id="search-input" placeholder="Search users, withdrawals...">
          <button class="button" onclick="searchData()">
            <i class="fas fa-search"></i> Search
          </button>
        </div>
      </div>
      
      <!-- Statistics -->
      <div class="admin-stats">
        <div class="stat-card">
          <div class="stat-value" id="total-users">0</div>
          <div class="stat-label">Total Users</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="pending-withdrawals">0</div>
          <div class="stat-label">Pending Withdrawals</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="total-withdrawals">0</div>
          <div class="stat-label">Total Withdrawals</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="total-earned">$0</div>
          <div class="stat-label">Platform Earnings</div>
        </div>
      </div>
      
      <!-- Tabs -->
      <div class="tabs">
        <div class="tab active" onclick="switchTab('withdrawals')">
          <i class="fas fa-money-bill-wave"></i> Withdrawals
        </div>
        <div class="tab" onclick="switchTab('users')">
          <i class="fas fa-users"></i> Users
        </div>
        <div class="tab" onclick="switchTab('settings')">
          <i class="fas fa-cog"></i> Settings
        </div>
        <div class="tab" onclick="switchTab('broadcast')">
          <i class="fas fa-bullhorn"></i> Broadcast
        </div>
      </div>
      
      <!-- Withdrawals Tab -->
      <div id="withdrawals-tab" class="tab-content active">
        <div class="card">
          <div class="card-header">
            <i class="fas fa-money-bill-wave"></i>
            <h3>Withdrawal Requests</h3>
          </div>
          <div class="card-content">
            <div class="table-container">
              <table id="withdrawals-table">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>User</th>
                    <th>Amount</th>
                    <th>Method</th>
                    <th>Address</th>
                    <th>Date</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="withdrawals-tbody">
                  <!-- Table rows will be generated here -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Users Tab -->
      <div id="users-tab" class="tab-content">
        <div class="card">
          <div class="card-header">
            <i class="fas fa-users"></i>
            <h3>User Management</h3>
          </div>
          <div class="card-content">
            <div id="users-container">
              <!-- User cards will be generated here -->
            </div>
          </div>
        </div>
      </div>
      
      <!-- Settings Tab -->
      <div id="settings-tab" class="tab-content">
        <div class="card">
          <div class="card-header">
            <i class="fas fa-cog"></i>
            <h3>Platform Settings</h3>
          </div>
          <div class="card-content">
            <div class="input-group">
              <label>Minimum Withdrawal Amount ($)</label>
              <input type="number" id="min-withdrawal" placeholder="30">
            </div>
            
            <div class="input-group">
              <label>Minimum Referrals for Withdrawal</label>
              <input type="number" id="min-referrals" placeholder="10">
            </div>
            
            <div class="input-group">
              <label>Earnings Per Task ($)</label>
              <input type="number" id="earnings-per-task" step="0.001" placeholder="0.025">
            </div>
            
            <div class="input-group">
              <label>Referral Bonus ($)</label>
              <input type="number" id="referral-bonus" step="0.01" placeholder="0.50">
            </div>
            
            <div class="input-group">
              <label>Daily Task Limit</label>
              <input type="number" id="daily-task-limit" placeholder="100">
            </div>
            
            <button class="button" onclick="saveSettings()">
              <i class="fas fa-save"></i> Save All Settings
            </button>
          </div>
        </div>
      </div>
      
      <!-- Broadcast Tab -->
      <div id="broadcast-tab" class="tab-content">
        <div class="card">
          <div class="card-header">
            <i class="fas fa-bullhorn"></i>
            <h3>Broadcast Message</h3>
          </div>
          <div class="card-content">
            <div class="input-group">
              <label>Message Title</label>
              <input type="text" id="broadcast-title" placeholder="Enter message title">
            </div>
            
            <div class="input-group">
              <label>Message Content</label>
              <textarea id="broadcast-content" rows="5" placeholder="Enter your broadcast message..."></textarea>
            </div>
            
            <button class="button" onclick="sendBroadcast()">
              <i class="fas fa-paper-plane"></i> Send Broadcast to All Users
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Payment Proof Modal -->
  <div class="modal" id="payment-proof-modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">Submit Payment Proof</div>
        <button class="modal-close" onclick="closeModal('payment-proof-modal')">&times;</button>
      </div>
      
      <div class="input-group">
        <label>Transaction ID</label>
        <input type="text" id="transaction-id" placeholder="Enter transaction ID">
      </div>
      
      <div class="input-group">
        <label>Payment Screenshot URL</label>
        <input type="text" id="payment-screenshot" placeholder="Enter screenshot URL">
      </div>
      
      <div class="input-group">
        <label>Additional Notes</label>
        <textarea id="payment-notes" rows="3" placeholder="Any additional notes..."></textarea>
      </div>
      
      <button class="button button-success" onclick="submitPaymentProof()">
        <i class="fas fa-check"></i> Submit Payment Proof
      </button>
    </div>
  </div>
  
  <script>
    // Real Admin System
    const ADMIN_CREDENTIALS = {
      username: "admin",
      password: "admin123"
    };
    
    // Initialize data
    let adminData = JSON.parse(localStorage.getItem("adminData")) || {
      users: [],
      withdrawals: [],
      settings: {
        minWithdrawal: 30,
        minReferrals: 10,
        earningsPerTask: 0.025,
        referralBonus: 0.50,
        dailyTaskLimit: 100
      },
      broadcastMessages: []
    };
    
    // Check if admin is logged in
    if (localStorage.getItem("adminLoggedIn") === "true") {
      showAdminPanel();
    }
    
    function adminLogin() {
      const username = document.getElementById("admin-username").value;
      const password = document.getElementById("admin-password").value;
      
      if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
        localStorage.setItem("adminLoggedIn", "true");
        showAdminPanel();
        showNotification("Admin login successful!", "success");
        
        // Load real user data from main app
        loadRealUserData();
      } else {
        showNotification("Invalid username or password!", "error");
      }
    }
    
    function adminLogout() {
      localStorage.removeItem("adminLoggedIn");
      document.getElementById("login-page").style.display = "flex";
      document.getElementById("admin-panel").style.display = "none";
    }
    
    function showAdminPanel() {
      document.getElementById("login-page").style.display = "none";
      document.getElementById("admin-panel").style.display = "block";
      loadDashboard();
    }
    
    function showNotification(message, type) {
      const notification = document.getElementById("notification");
      const messageElement = document.getElementById("notification-message");
      
      messageElement.textContent = message;
      notification.className = "notification " + type;
      notification.classList.add("show");
      
      setTimeout(() => {
        notification.classList.remove("show");
      }, 4000);
    }
    
    function switchTab(tabName) {
      // Hide all tabs
      document.querySelectorAll(".tab-content").forEach(tab => {
        tab.classList.remove("active");
      });
      
      // Remove active class from all tabs
      document.querySelectorAll(".tab").forEach(tab => {
        tab.classList.remove("active");
      });
      
      // Show selected tab
      document.getElementById(tabName + "-tab").classList.add("active");
      event.target.classList.add("active");
      
      // Load tab data
      if (tabName === "withdrawals") {
        loadWithdrawals();
      } else if (tabName === "users") {
        loadUsers();
      } else if (tabName === "settings") {
        loadSettings();
      }
    }
    
    function loadDashboard() {
      loadWithdrawals();
      updateStats();
    }
    
    function updateStats() {
      const totalUsers = adminData.users.length;
      const pendingWithdrawals = adminData.withdrawals.filter(w => w.status === "pending").length;
      const totalWithdrawals = adminData.withdrawals.length;
      const totalEarned = adminData.withdrawals
        .filter(w => w.status === "completed")
        .reduce((sum, w) => sum + parseFloat(w.amount), 0);
      
      document.getElementById("total-users").textContent = totalUsers;
      document.getElementById("pending-withdrawals").textContent = pendingWithdrawals;
      document.getElementById("total-withdrawals").textContent = totalWithdrawals;
      document.getElementById("total-earned").textContent = "$" + totalEarned.toFixed(2);
    }
    
    function loadRealUserData() {
      // Load users from main app
      try {
        const mainAppUsers = JSON.parse(localStorage.getItem("MTEarningData"));
        if (mainAppUsers && !Array.isArray(mainAppUsers)) {
          // Convert single user to array
          adminData.users = [mainAppUsers];
        } else if (Array.isArray(mainAppUsers)) {
          adminData.users = mainAppUsers;
        }
        
        // Load withdrawals from main app
        const mainAppWithdrawals = JSON.parse(localStorage.getItem("withdrawals"));
        if (mainAppWithdrawals) {
          adminData.withdrawals = mainAppWithdrawals;
        }
        
        localStorage.setItem("adminData", JSON.stringify(adminData));
        loadDashboard();
      } catch (e) {
        console.log("No existing user data found");
      }
    }
    
    function loadWithdrawals() {
      const tbody = document.getElementById("withdrawals-tbody");
      tbody.innerHTML = "";
      
      if (adminData.withdrawals.length === 0) {
        tbody.innerHTML = `<tr><td colspan="8" style="text-align: center; padding: 20px;">No withdrawal requests found</td></tr>`;
        return;
      }
      
      adminData.withdrawals.forEach(withdrawal => {
        const row = document.createElement("tr");
        
        row.innerHTML = `
          <td>${withdrawal.id}</td>
          <td>
            <strong>${withdrawal.username}</strong><br>
            <small>ID: ${withdrawal.userId}</small>
          </td>
          <td>$${withdrawal.amount}</td>
          <td>${withdrawal.method}</td>
          <td>${withdrawal.address}</td>
          <td>${withdrawal.date}</td>
          <td class="status-${withdrawal.status}">${withdrawal.status.charAt(0).toUpperCase() + withdrawal.status.slice(1)}</td>
          <td>
            ${withdrawal.status === "pending" ? `
              <button class="button button-success button-small" onclick="completeWithdrawal(${withdrawal.id})">
                <i class="fas fa-check"></i> Pay
              </button>
              <button class="button button-danger button-small" onclick="rejectWithdrawal(${withdrawal.id})">
                <i class="fas fa-times"></i> Reject
              </button>
            ` : ""}
            <button class="button button-warning button-small" onclick="viewWithdrawal(${withdrawal.id})">
              <i class="fas fa-eye"></i> Details
            </button>
          </td>
        `;
        
        tbody.appendChild(row);
      });
      
      updateStats();
    }
    
    function loadUsers() {
      const container = document.getElementById("users-container");
      container.innerHTML = "";
      
      if (adminData.users.length === 0) {
        container.innerHTML = `<div style="text-align: center; padding: 20px;">No users found</div>`;
        return;
      }
      
      adminData.users.forEach(user => {
        const userCard = document.createElement("div");
        userCard.className = "user-card";
        
        userCard.innerHTML = `
          <div class="user-header">
            <div>
              <div class="user-name">${user.username}</div>
              <div class="user-id">ID: ${user.userId}</div>
            </div>
            <button class="button button-small" onclick="viewUser(${user.userId})">
              <i class="fas fa-eye"></i> View
            </button>
          </div>
          
          <div class="user-stats">
            <div class="user-stat">
              <div class="user-stat-value">$${user.lifetimeEarning ? user.lifetimeEarning.toFixed(3) : "0.000"}</div>
              <div class="user-stat-label">Earnings</div>
            </div>
            <div class="user-stat">
              <div class="user-stat-value">${user.referrals || 0}</div>
              <div class="user-stat-label">Referrals</div>
            </div>
            <div class="user-stat">
              <div class="user-stat-value">${user.totalTasks || 0}</div>
              <div class="user-stat-label">Tasks</div>
            </div>
          </div>
          
          <div style="font-size: 0.8rem; color: #666;">
            Joined: ${user.joinDate || "Unknown"}
          </div>
        `;
        
        container.appendChild(userCard);
      });
    }
    
    function loadSettings() {
      document.getElementById("min-withdrawal").value = adminData.settings.minWithdrawal;
      document.getElementById("min-referrals").value = adminData.settings.minReferrals;
      document.getElementById("earnings-per-task").value = adminData.settings.earningsPerTask;
      document.getElementById("referral-bonus").value = adminData.settings.referralBonus;
      document.getElementById("daily-task-limit").value = adminData.settings.dailyTaskLimit;
    }
    
    function completeWithdrawal(id) {
      const withdrawal = adminData.withdrawals.find(w => w.id === id);
      if (withdrawal) {
        withdrawal.status = "completed";
        withdrawal.processedDate = new Date().toLocaleDateString();
        withdrawal.processedBy = "admin";
        
        localStorage.setItem("adminData", JSON.stringify(adminData));
        
        // Also update main app data
        const mainAppWithdrawals = JSON.parse(localStorage.getItem("withdrawals")) || [];
        const mainWithdrawal = mainAppWithdrawals.find(w => w.id === id);
        if (mainWithdrawal) {
          mainWithdrawal.status = "completed";
          localStorage.setItem("withdrawals", JSON.stringify(mainAppWithdrawals));
        }
        
        showNotification(`Payment completed for $${withdrawal.amount} to ${withdrawal.username}`, "success");
        loadWithdrawals();
        
        // Open payment proof modal
        document.getElementById("payment-proof-modal").style.display = "flex";
        currentWithdrawalId = id;
      }
    }
    
    function rejectWithdrawal(id) {
      const withdrawal = adminData.withdrawals.find(w => w.id === id);
      if (withdrawal) {
        withdrawal.status = "rejected";
        withdrawal.processedDate = new Date().toLocaleDateString();
        withdrawal.processedBy = "admin";
        
        localStorage.setItem("adminData", JSON.stringify(adminData));
        
        // Also update main app data
        const mainAppWithdrawals = JSON.parse(localStorage.getItem("withdrawals")) || [];
        const mainWithdrawal = mainAppWithdrawals.find(w => w.id === id);
        if (mainWithdrawal) {
          mainWithdrawal.status = "rejected";
          localStorage.setItem("withdrawals", JSON.stringify(mainAppWithdrawals));
        }
        
        showNotification(`Withdrawal rejected for $${withdrawal.amount}`, "warning");
        loadWithdrawals();
      }
    }
    
    function viewWithdrawal(id) {
      const withdrawal = adminData.withdrawals.find(w => w.id === id);
      if (withdrawal) {
        alert(`Withdrawal Details:\n\nUser: ${withdrawal.username} (ID: ${withdrawal.userId})\nAmount: $${withdrawal.amount}\nMethod: ${withdrawal.method}\nAddress: ${withdrawal.address}\nDate: ${withdrawal.date}\nStatus: ${withdrawal.status}\n${withdrawal.processedDate ? `Processed: ${withdrawal.processedDate} by ${withdrawal.processedBy}` : ''}`);
      }
    }
    
    function viewUser(userId) {
      const user = adminData.users.find(u => u.userId == userId);
      if (user) {
        alert(`User Details:\n\nUsername: ${user.username}\nUser ID: ${user.userId}\nTotal Earnings: $${user.lifetimeEarning ? user.lifetimeEarning.toFixed(3) : "0.000"}\nTotal Tasks: ${user.totalTasks || 0}\nReferrals: ${user.referrals || 0}\nReferral Earnings: $${user.referralEarnings ? user.referralEarnings.toFixed(3) : "0.000"}\nJoin Date: ${user.joinDate || "Unknown"}`);
      }
    }
    
    function saveSettings() {
      adminData.settings.minWithdrawal = parseInt(document.getElementById("min-withdrawal").value) || 30;
      adminData.settings.minReferrals = parseInt(document.getElementById("min-referrals").value) || 10;
      adminData.settings.earningsPerTask = parseFloat(document.getElementById("earnings-per-task").value) || 0.025;
      adminData.settings.referralBonus = parseFloat(document.getElementById("referral-bonus").value) || 0.50;
      adminData.settings.dailyTaskLimit = parseInt(document.getElementById("daily-task-limit").value) || 100;
      
      localStorage.setItem("adminData", JSON.stringify(adminData));
      
      // Also update main app settings
      const mainAppSettings = JSON.parse(localStorage.getItem("adminSettings")) || {};
      Object.assign(mainAppSettings, adminData.settings);
      localStorage.setItem("adminSettings", JSON.stringify(mainAppSettings));
      
      showNotification("Settings saved successfully!", "success");
    }
    
    function sendBroadcast() {
      const title = document.getElementById("broadcast-title").value;
      const content = document.getElementById("broadcast-content").value;
      
      if (!title || !content) {
        showNotification("Please enter both title and content!", "error");
        return;
      }
      
      const broadcast = {
        id: Date.now(),
        title,
        content,
        date: new Date().toLocaleString(),
        sentBy: "admin"
      };
      
      adminData.broadcastMessages.push(broadcast);
      localStorage.setItem("adminData", JSON.stringify(adminData));
      
      // Clear form
      document.getElementById("broadcast-title").value = "";
      document.getElementById("broadcast-content").value = "";
      
      showNotification("Broadcast message sent to all users!", "success");
    }
    
    function searchData() {
      const searchTerm = document.getElementById("search-input").value.toLowerCase();
      
      // For now, just filter withdrawals
      const filteredWithdrawals = adminData.withdrawals.filter(w => 
        w.username.toLowerCase().includes(searchTerm) ||
        w.userId.toLowerCase().includes(searchTerm) ||
        w.address.toLowerCase().includes(searchTerm) ||
        w.method.toLowerCase().includes(searchTerm)
      );
      
      const tbody = document.getElementById("withdrawals-tbody");
      tbody.innerHTML = "";
      
      if (filteredWithdrawals.length === 0) {
        tbody.innerHTML = `<tr><td colspan="8" style="text-align: center; padding: 20px;">No matching withdrawals found</td></tr>`;
        return;
      }
      
      filteredWithdrawals.forEach(withdrawal => {
        const row = document.createElement("tr");
        
        row.innerHTML = `
          <td>${withdrawal.id}</td>
          <td>
            <strong>${withdrawal.username}</strong><br>
            <small>ID: ${withdrawal.userId}</small>
          </td>
          <td>$${withdrawal.amount}</td>
          <td>${withdrawal.method}</td>
          <td>${withdrawal.address}</td>
          <td>${withdrawal.date}</td>
          <td class="status-${withdrawal.status}">${withdrawal.status.charAt(0).toUpperCase() + withdrawal.status.slice(1)}</td>
          <td>
            ${withdrawal.status === "pending" ? `
              <button class="button button-success button-small" onclick="completeWithdrawal(${withdrawal.id})">
                <i class="fas fa-check"></i> Pay
              </button>
              <button class="button button-danger button-small" onclick="rejectWithdrawal(${withdrawal.id})">
                <i class="fas fa-times"></i> Reject
              </button>
            ` : ""}
            <button class="button button-warning button-small" onclick="viewWithdrawal(${withdrawal.id})">
              <i class="fas fa-eye"></i> Details
            </button>
          </td>
        `;
        
        tbody.appendChild(row);
      });
    }
    
    let currentWithdrawalId = null;
    
    function closeModal(modalId) {
      document.getElementById(modalId).style.display = "none";
    }
    
    function submitPaymentProof() {
      const transactionId = document.getElementById("transaction-id").value;
      const screenshot = document.getElementById("payment-screenshot").value;
      const notes = document.getElementById("payment-notes").value;
      
      if (!transactionId) {
        showNotification("Please enter transaction ID!", "error");
        return;
      }
      
      const withdrawal = adminData.withdrawals.find(w => w.id === currentWithdrawalId);
      if (withdrawal) {
        withdrawal.transactionId = transactionId;
        withdrawal.paymentScreenshot = screenshot;
        withdrawal.paymentNotes = notes;
        withdrawal.paymentDate = new Date().toLocaleString();
        
        localStorage.setItem("adminData", JSON.stringify(adminData));
        
        // Clear form
        document.getElementById("transaction-id").value = "";
        document.getElementById("payment-screenshot").value = "";
        document.getElementById("payment-notes").value = "";
        
        closeModal("payment-proof-modal");
        showNotification("Payment proof submitted successfully!", "success");
      }
    }
    
    // Add some test data if none exists
    if (adminData.withdrawals.length === 0) {
      adminData.withdrawals = [
        {
          id: 1001,
          userId: "user123",
          username: "TestUser1",
          amount: "35.50",
          method: "Bkash",
          address: "017XXXXXXXX",
          date: new Date().toLocaleDateString(),
          status: "pending"
        },
        {
          id: 1002,
          userId: "user456",
          username: "TestUser2",
          amount: "50.00",
          method: "USDT",
          address: "TYgXXXXXXXXXXXX",
          date: new Date().toLocaleDateString(),
          status: "pending"
        }
      ];
      
      localStorage.setItem("adminData", JSON.stringify(adminData));
    }
  </script>
</body>
</html>
